{"title":"React快速入门（四）ReactHooks","uid":"94f97ab699adb2aaa1406546b0a18779","slug":"React快速入门（四）ReactHooks","date":"2025-12-02T15:06:00.000Z","updated":"2025-12-02T15:07:18.424Z","comments":true,"path":"api/articles/React快速入门（四）ReactHooks.json","keywords":"web前端开发,web前端博客,个人博客,html,css,javascript,vue,react","cover":"https://i-blog.csdnimg.cn/blog_migrate/cover/7ae60f2846f83a4bd4333f2e9b649239.jpeg","content":"<h1 id=\"React快速入门（四）ReactHooks\"><a href=\"#React快速入门（四）ReactHooks\" class=\"headerlink\" title=\"React快速入门（四）ReactHooks\"></a>React快速入门（四）ReactHooks</h1><ul>\n<li>Hook是React 16.8的新增特性，它可以让我们在不编写class的情况下使用state以及其他的React特性(比如生命周期)。</li>\n<li><strong>class组件相对于函数式组件的优势:</strong><ul>\n<li><strong>class组件可以定义自己的state，用来保存组件自己内部的状态</strong><ul>\n<li>函数式组件不可以，因为函数每次调用都会产生新的临时变量</li>\n</ul>\n</li>\n<li><strong>class组件有自己的生命周期，我们可以在对应的生命周期中完成自己的逻辑</strong><ul>\n<li>在componentDidMount中发送网络请求，并且该生命周期函数只会执行一次</li>\n<li>函数式组件在之前，如果在函数中发送网络请求，意味着每次重新渲染都会重新发送一网络请求</li>\n</ul>\n</li>\n<li><strong>class组件可以在状态改变时只会重新执行render函数以及我们希望重新调用的生命周期函数componentDidUpdate等</strong><ul>\n<li>函数式组件在重新渲染时，整个函数都会被执行，似乎没有什么地方可以只让它们调用一次</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><strong>class组件存在的问题</strong><ul>\n<li>复杂组件难以理解，逻辑冗余，代码复杂度高</li>\n<li>class难以理解，需要关注this的指向问题</li>\n<li>组件复用比较难，需要通过高阶组件来实现复用</li>\n</ul>\n</li>\n</ul>\n<p><strong>Hook的出现</strong></p>\n<ul>\n<li><strong>可以让我们在不编写class的情况下使用state以及其他的React特性;我们可以由此延伸出非常多的用法，来解决class组件存在的问题</strong></li>\n<li>Hook的使用场景:<ul>\n<li>Hook的出现基本可以代替我们之前所有使用class组件的地方</li>\n<li>但是如果是一个旧的项目，你并不需要直接将所有的代码重构为Hooks，因为它完全向下兼容，你可以渐进式的来使用它</li>\n<li>Hook只能在函数组件中使用，不能在类组件，或者函数组件之外的地方使用</li>\n</ul>\n</li>\n<li><strong>Hook是:完全可选的、100%向后兼容的、当前可用</strong></li>\n<li>可以参考：<a href=\"https://juejin.cn/post/7118937685653192735\">「React 进阶」 React 全部 Hooks 使用大全 （包含 React v18 版本 ） - 掘金 (juejin.cn)</a></li>\n</ul>\n<hr>\n<h2 id=\"useState\"><a href=\"#useState\" class=\"headerlink\" title=\"useState\"></a>useState</h2><ul>\n<li>useState会帮助我们定义一个state变量，useState是一种新方法，它与class里面的this.state提供的功能完全相同。<ul>\n<li>一般来说，在函数退出后变量就会”消失”，而state 中的变量会被React保留。</li>\n<li>useState接受唯一一个参数，在第一次组件被调用时使用来作为初始化值。(如果没有传递参数，那么初始化值为undefined)。</li>\n<li>useState的返回值是一个数组，我们可以通过数组的解构，来完成赋值会非常方便。</li>\n</ul>\n</li>\n</ul>\n<div class=\"language-jsx\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">jsx</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1d1d1d\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #676E95; font-style: italic\">// 直接给定初始值</span></span>\n<span class=\"line\"><span style=\"color: #C792EA\">const</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">状态名</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> set函数</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">useState</span><span style=\"color: #BABED8\">(初始值)</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\">// 函数返回值的形式</span></span>\n<span class=\"line\"><span style=\"color: #C792EA\">const</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">value</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> setValue</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">useState</span><span style=\"color: #BABED8\">(</span><span style=\"color: #89DDFF\">()</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #BABED8\"> 初始值)</span></span></code></pre></div><ul>\n<li>例如：</li>\n</ul>\n<div class=\"language-jsx\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">jsx</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1d1d1d\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #676E95; font-style: italic\">//类式组件写法：</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">import</span><span style=\"color: #BABED8\"> React</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">PureComponent</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF; font-style: italic\">from</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">react</span><span style=\"color: #89DDFF\">&#39;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">export</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C792EA\">class</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">CounterClass</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C792EA\">extends</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">PureComponent</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">  </span><span style=\"color: #C792EA\">constructor</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">props</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #BABED8\">super</span><span style=\"color: #F07178\">(</span><span style=\"color: #BABED8\">props</span><span style=\"color: #F07178\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #89DDFF\">this.</span><span style=\"color: #BABED8\">state</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">      counter</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #F07178\"> </span><span style=\"color: #F78C6C\">0</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">  </span><span style=\"color: #F07178\">increment</span><span style=\"color: #89DDFF\">()</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #89DDFF\">this.</span><span style=\"color: #82AAFF\">setState</span><span style=\"color: #F07178\">(</span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">      counter</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">this.</span><span style=\"color: #BABED8\">state</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">counter</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #F07178\"> </span><span style=\"color: #F78C6C\">1</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #F07178\">)</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">  </span><span style=\"color: #F07178\">decrement</span><span style=\"color: #89DDFF\">()</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #89DDFF\">this.</span><span style=\"color: #82AAFF\">setState</span><span style=\"color: #F07178\">(</span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">      counter</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">this.</span><span style=\"color: #BABED8\">state</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">counter</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">-</span><span style=\"color: #F07178\"> </span><span style=\"color: #F78C6C\">1</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #F07178\">)</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">  </span><span style=\"color: #F07178\">render</span><span style=\"color: #89DDFF\">()</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #C792EA\">const</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&#123;</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">counter</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">this.</span><span style=\"color: #BABED8\">state</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #F07178\"> (</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">      </span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #F07178\">div</span><span style=\"color: #89DDFF\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #F07178\">h2</span><span style=\"color: #89DDFF\">&gt;</span><span style=\"color: #BABED8\">当前计数: </span><span style=\"color: #89DDFF\">&#123;</span><span style=\"color: #BABED8\">counter</span><span style=\"color: #89DDFF\">&#125;&lt;/</span><span style=\"color: #F07178\">h2</span><span style=\"color: #89DDFF\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #F07178\">button</span><span style=\"color: #89DDFF\"> </span><span style=\"color: #C792EA\">onClick</span><span style=\"color: #89DDFF\">=&#123;</span><span style=\"color: #BABED8; font-style: italic\">e</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">this.</span><span style=\"color: #82AAFF\">increment</span><span style=\"color: #BABED8\">()</span><span style=\"color: #89DDFF\">&#125;&gt;</span><span style=\"color: #BABED8\">+1</span><span style=\"color: #89DDFF\">&lt;/</span><span style=\"color: #F07178\">button</span><span style=\"color: #89DDFF\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #F07178\">button</span><span style=\"color: #89DDFF\"> </span><span style=\"color: #C792EA\">onClick</span><span style=\"color: #89DDFF\">=&#123;</span><span style=\"color: #BABED8; font-style: italic\">e</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">this.</span><span style=\"color: #82AAFF\">decrement</span><span style=\"color: #BABED8\">()</span><span style=\"color: #89DDFF\">&#125;&gt;</span><span style=\"color: #BABED8\">-1</span><span style=\"color: #89DDFF\">&lt;/</span><span style=\"color: #F07178\">button</span><span style=\"color: #89DDFF\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">      </span><span style=\"color: #89DDFF\">&lt;/</span><span style=\"color: #F07178\">div</span><span style=\"color: #89DDFF\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    )</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">export</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF; font-style: italic\">default</span><span style=\"color: #BABED8\"> CounterClass</span></span></code></pre></div><div class=\"language-jsx\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">jsx</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1d1d1d\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #676E95; font-style: italic\">//函数式组件hook写法：</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\">//只能在函数最外层调用 Hook。不要在循环、条件判断或者子函数中调用。</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\">//只能在React的函数组件中调用Hook。不要在其他JavaScript函数中调用 。</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">import</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">memo</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">useState</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF; font-style: italic\">from</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">react</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #C792EA\">function</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">CounterHook</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">props</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\">// useState是一个hook，参数：初始化值，不设置则为undefined;返回值：数组，包含两个元素,[当前值的状态，设置状态值的函数]</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #C792EA\">const</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">counter</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">setCounter</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #82AAFF\">useState</span><span style=\"color: #F07178\">(</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #F07178\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #F07178\"> (</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #F07178\">div</span><span style=\"color: #89DDFF\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">      </span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #F07178\">h2</span><span style=\"color: #89DDFF\">&gt;</span><span style=\"color: #BABED8\">当前计数: </span><span style=\"color: #89DDFF\">&#123;</span><span style=\"color: #BABED8\">counter</span><span style=\"color: #89DDFF\">&#125;&lt;/</span><span style=\"color: #F07178\">h2</span><span style=\"color: #89DDFF\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">      </span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #F07178\">button</span><span style=\"color: #89DDFF\"> </span><span style=\"color: #C792EA\">onClick</span><span style=\"color: #89DDFF\">=&#123;</span><span style=\"color: #BABED8; font-style: italic\">e</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">setCounter</span><span style=\"color: #BABED8\">(counter</span><span style=\"color: #89DDFF\">+</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #BABED8\">)</span><span style=\"color: #89DDFF\">&#125;&gt;</span><span style=\"color: #BABED8\">+1</span><span style=\"color: #89DDFF\">&lt;/</span><span style=\"color: #F07178\">button</span><span style=\"color: #89DDFF\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">      </span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #F07178\">button</span><span style=\"color: #89DDFF\"> </span><span style=\"color: #C792EA\">onClick</span><span style=\"color: #89DDFF\">=&#123;</span><span style=\"color: #BABED8; font-style: italic\">e</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">setCounter</span><span style=\"color: #BABED8\">(counter</span><span style=\"color: #89DDFF\">-</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #BABED8\">)</span><span style=\"color: #89DDFF\">&#125;&gt;</span><span style=\"color: #BABED8\">-1</span><span style=\"color: #89DDFF\">&lt;/</span><span style=\"color: #F07178\">button</span><span style=\"color: #89DDFF\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF\">&lt;/</span><span style=\"color: #F07178\">div</span><span style=\"color: #89DDFF\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  )</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">export</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF; font-style: italic\">default</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">memo</span><span style=\"color: #BABED8\">(CounterHook)</span></span></code></pre></div><ul>\n<li>注意：当函数式组件被重新执行时，不会重复调用 useState() 给数据赋初值，而是<strong>会复用上次的 state 值。</strong></li>\n</ul>\n<div class=\"language-jsx\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">jsx</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1d1d1d\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #676E95; font-style: italic\">// 以函数的形式为状态赋初始值</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">import</span><span style=\"color: #BABED8\"> React</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">useState</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF; font-style: italic\">from</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">react</span><span style=\"color: #89DDFF\">&#39;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #C792EA\">const</span><span style=\"color: #BABED8\"> App</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">React</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #FFCB6B\">FC</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">()</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #C792EA\">const</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">date</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">setDate</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #82AAFF\">useState</span><span style=\"color: #F07178\">(</span><span style=\"color: #89DDFF\">()</span><span style=\"color: #F07178\"> </span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #C792EA\">const</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">dt</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">new</span><span style=\"color: #F07178\"> </span><span style=\"color: #82AAFF\">Date</span><span style=\"color: #F07178\">()</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&#123;</span><span style=\"color: #F07178\"> year</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">dt</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">getFullYear</span><span style=\"color: #F07178\">()</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> month</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">dt</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">getMonth</span><span style=\"color: #F07178\">() </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #F07178\"> </span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> day</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">dt</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">getDate</span><span style=\"color: #F07178\">() </span><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #F07178\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #F07178\"> (</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #F07178\">div</span><span style=\"color: #89DDFF\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">      </span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #F07178\">h1</span><span style=\"color: #89DDFF\">&gt;</span><span style=\"color: #BABED8\">今日信息：</span><span style=\"color: #89DDFF\">&lt;/</span><span style=\"color: #F07178\">h1</span><span style=\"color: #89DDFF\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">      </span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #F07178\">p</span><span style=\"color: #89DDFF\">&gt;</span><span style=\"color: #BABED8\">年份：</span><span style=\"color: #89DDFF\">&#123;</span><span style=\"color: #BABED8\">date</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">year</span><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #BABED8\">年</span><span style=\"color: #89DDFF\">&lt;/</span><span style=\"color: #F07178\">p</span><span style=\"color: #89DDFF\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">      </span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #F07178\">p</span><span style=\"color: #89DDFF\">&gt;</span><span style=\"color: #BABED8\">月份：</span><span style=\"color: #89DDFF\">&#123;</span><span style=\"color: #BABED8\">date</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">month</span><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #BABED8\">月</span><span style=\"color: #89DDFF\">&lt;/</span><span style=\"color: #F07178\">p</span><span style=\"color: #89DDFF\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">      </span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #F07178\">p</span><span style=\"color: #89DDFF\">&gt;</span><span style=\"color: #BABED8\">日期：</span><span style=\"color: #89DDFF\">&#123;</span><span style=\"color: #BABED8\">date</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">day</span><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #BABED8\">日</span><span style=\"color: #89DDFF\">&lt;/</span><span style=\"color: #F07178\">p</span><span style=\"color: #89DDFF\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF\">&lt;/</span><span style=\"color: #F07178\">div</span><span style=\"color: #89DDFF\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  )</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">export</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF; font-style: italic\">default</span><span style=\"color: #BABED8\"> App</span></span></code></pre></div><ul>\n<li>注意：以函数的形式为状态赋初始值时，<strong>只有组件首次被渲染才会执行 fn 函数</strong>；当组件被更新时，会以更新前的值作为状态的初始值，赋初始值的函数不会执行。</li>\n<li><strong>注意事项</strong>：<ol>\n<li>如果要更新对象类型的值，并触发组件的重新渲染，则必须使用<strong>展开运算符</strong>或**Object.assign()**生成一个新对象，用新对象覆盖旧对象，才能正常触发组件的重新渲染。</li>\n<li>当连续多次<strong>以相同的操作</strong>更新状态值时，React 内部会对传递过来的新值进行比较，如果值相同，则会屏蔽后续的更新行为，从而防止组件频繁渲染的问题。这虽然提高了性能，但也带来了一个使用误区。为了解决这个问题，我们可以使用<strong>函数的方式</strong>给状态赋新值。当函数执行时才通过函数的形参，拿到当前的状态值，并基于它返回新的状态值。</li>\n<li>在函数组件中，我们可以通过 useState 来<strong>模拟 forceUpdate 的强制刷新操作</strong>。因为只要 useState 的状态发生了变化，就会触发函数组件的重新渲染，从而达到强制刷新的目的。</li>\n</ol>\n</li>\n</ul>\n<hr>\n<h2 id=\"useRef\"><a href=\"#useRef\" class=\"headerlink\" title=\"useRef\"></a>useRef</h2><ul>\n<li>useRef返回一个ref对象，返回的ref对象在组件的整个生命周期保持不变。</li>\n<li>用途：获取DOM元素或子组件的实例对象，存储渲染周期之间共享的数据，这个对象在整个生命周期中可以保存不变</li>\n</ul>\n<div class=\"language-jsx\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">jsx</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1d1d1d\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">import</span><span style=\"color: #BABED8\"> React</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">memo</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">useRef</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF; font-style: italic\">from</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">react</span><span style=\"color: #89DDFF\">&#39;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #C792EA\">const</span><span style=\"color: #BABED8\"> App </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">memo</span><span style=\"color: #BABED8\">(</span><span style=\"color: #89DDFF\">()</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #C792EA\">const</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">titleRef</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #82AAFF\">useRef</span><span style=\"color: #F07178\">()</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #C792EA\">const</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">inputRef</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #82AAFF\">useRef</span><span style=\"color: #F07178\">()</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #C792EA\">function</span><span style=\"color: #F07178\"> </span><span style=\"color: #82AAFF\">showTitleDom</span><span style=\"color: #89DDFF\">()</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #BABED8\">console</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">log</span><span style=\"color: #F07178\">(</span><span style=\"color: #BABED8\">titleRef</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">current</span><span style=\"color: #F07178\">)</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #BABED8\">inputRef</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">current</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">focus</span><span style=\"color: #F07178\">()</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #F07178\"> (</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #F07178\">div</span><span style=\"color: #89DDFF\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">      </span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #F07178\">h2</span><span style=\"color: #89DDFF\"> </span><span style=\"color: #C792EA\">ref</span><span style=\"color: #89DDFF\">=&#123;</span><span style=\"color: #BABED8\">titleRef</span><span style=\"color: #89DDFF\">&#125;&gt;</span><span style=\"color: #BABED8\">Hello World</span><span style=\"color: #89DDFF\">&lt;/</span><span style=\"color: #F07178\">h2</span><span style=\"color: #89DDFF\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">      </span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #F07178\">input</span><span style=\"color: #89DDFF\"> </span><span style=\"color: #C792EA\">type</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">text</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\"> </span><span style=\"color: #C792EA\">ref</span><span style=\"color: #89DDFF\">=&#123;</span><span style=\"color: #BABED8\">inputRef</span><span style=\"color: #89DDFF\">&#125; /&gt;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">      </span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #F07178\">button</span><span style=\"color: #89DDFF\"> </span><span style=\"color: #C792EA\">onClick</span><span style=\"color: #89DDFF\">=&#123;</span><span style=\"color: #BABED8\">showTitleDom</span><span style=\"color: #89DDFF\">&#125;&gt;</span><span style=\"color: #BABED8\">查看title的dom</span><span style=\"color: #89DDFF\">&lt;/</span><span style=\"color: #F07178\">button</span><span style=\"color: #89DDFF\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF\">&lt;/</span><span style=\"color: #F07178\">div</span><span style=\"color: #89DDFF\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  )</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #BABED8\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">export</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF; font-style: italic\">default</span><span style=\"color: #BABED8\"> App</span></span></code></pre></div><ul>\n<li><p><strong>注意事项：</strong></p>\n<ol>\n<li><strong>组件rerender时useRef不会被重复初始化</strong></li>\n<li><strong>ref.current变化时不会造成组件的rerender</strong></li>\n<li>ref.current 值的变化不会造成组件的 rerender，而且 React 也不会跟踪 ref.current 的变化，因此 <strong>ref.current 不可以作为其它 hooks（useMemo、useCallback、useEffect 等） 的依赖项。</strong></li>\n<li>ref 的作用是获取实例，但由于<strong>函数组件不存在实例，因此无法通过 ref 获取函数组件的实例引用</strong>。<code>React.forwardRef</code> 会创建一个 React 组件，这个组件能够将其接收到的 ref 属性转发到自己的组件树。</li>\n</ol>\n<div class=\"language-jsx\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">jsx</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1d1d1d\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #676E95; font-style: italic\">// 被包装的函数式组件，第一个参数是 props，第二个参数是转发过来的 ref</span></span>\n<span class=\"line\"><span style=\"color: #C792EA\">const</span><span style=\"color: #BABED8\"> Child </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> React</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">forwardRef</span><span style=\"color: #BABED8\">(</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">props</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #BABED8; font-style: italic\">ref</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">  </span><span style=\"color: #676E95; font-style: italic\">// 省略子组件内部的具体实现</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #BABED8\">)</span></span></code></pre></div><ol start=\"5\">\n<li>通过uselmperativeHandle可以<strong>值暴露固定(forwardRef会将子组件的DOM直接暴露给了父元素)</strong></li>\n</ol>\n<div class=\"language-jsx\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">jsx</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1d1d1d\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #82AAFF\">useImperativeHandle</span><span style=\"color: #BABED8\">(通过forwardRef接收到的父组件的ref对象</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">()</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #BABED8\"> 自定义ref对象</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> [</span><span style=\"color: #82AAFF\">依赖项数组</span><span style=\"color: #BABED8\">(可选)])</span></span></code></pre></div><ul>\n<li>关于第三个参数（依赖项）：<ol>\n<li><strong>空数组</strong>：只在<strong>子组件首次被渲染</strong>时，执行 <code>useImperativeHandle</code> 中的 fn 回调，从而把 return 的对象作为父组件接收到的 ref。</li>\n<li><strong>依赖项数组</strong>：子组件<strong>首次被渲染</strong>时，<strong>依赖项改变</strong>时，会执行 <code>useImperativeHandle</code> 中的 fn 回调，从而让父组件通过 ref 能拿到依赖项的新值。</li>\n<li><strong>省略依赖项数组</strong>（省略第三个参数）：此时，组件内<strong>任何 state 的变化</strong>，都会导致 <code>useImperativeHandle</code> 中的回调的重新执行。</li>\n</ol>\n</li>\n</ul>\n</li>\n</ul>\n<hr>\n<h2 id=\"useEffect\"><a href=\"#useEffect\" class=\"headerlink\" title=\"useEffect\"></a>useEffect</h2><ul>\n<li>Effect Hook可以让你来完成一些类似于class中生命周期的功能;事实上，<strong>类似于网络请求、手动更新DOM、一些事件的监听，都是React更新DOM的一些副作用</strong>(Side Effects) ;所以对于完成这些功能的Hook被称之为Effect Hook</li>\n<li>useEffect要求我们传入一个回调函数，在React执行完更新DOM操作之后，就会回调这个函数;默认情况下，<strong>无论是第一次渲染之后，还是每次更新之后，都会执行这个回调函数</strong></li>\n<li>class组件的编写过程中，某些副作用的代码，需要在componentWillUnmount中清除。useEffect传入的<strong>回调函数A</strong>本身可以有一个返回值，这个返回值是另外一个<strong>回调函数B</strong>。这是effect可选的<strong>清除机制</strong>，每个effect都可以返回一个清除函数，可以将添加和移除订阅的逻辑放在一起。React会在组件更新和卸载的时候执行清除操作。</li>\n<li>useEffect有两个参数:<ul>\n<li>参数一:执行的回调函数;</li>\n<li>参数二:依赖项，该useEffect在哪些state发生变化时，才重新执行;(受谁的影响)<ul>\n<li><strong>省略依赖项数组，每次更新渲染完毕之后都会执行</strong></li>\n<li><strong>指定依赖项数组，每次渲染完毕之后，判断依赖项是否变化，再决定是否执行</strong></li>\n<li><strong>指定空数组，仅在首次渲染完毕之后，执行唯一的一次</strong></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>基础语法：</li>\n</ul>\n<div class=\"language-jsx\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">jsx</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1d1d1d\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #82AAFF\">useEffect</span><span style=\"color: #BABED8\">(</span><span style=\"color: #89DDFF\">()</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span><span style=\"color: #F07178\"> </span><span style=\"color: #676E95; font-style: italic\">/* 依赖项变化时，要触发的回调函数 */</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&#125;,</span><span style=\"color: #BABED8\"> [依赖项])</span></span></code></pre></div><ul>\n<li>例如：</li>\n</ul>\n<div class=\"language-jsx\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">jsx</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1d1d1d\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #676E95; font-style: italic\">// 类组件写法</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">import</span><span style=\"color: #BABED8\"> React</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">PureComponent</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF; font-style: italic\">from</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">react</span><span style=\"color: #89DDFF\">&#39;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">export</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C792EA\">class</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">App</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C792EA\">extends</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">PureComponent</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">  </span><span style=\"color: #C792EA\">constructor</span><span style=\"color: #89DDFF\">()</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #BABED8\">super</span><span style=\"color: #F07178\">()</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #89DDFF\">this.</span><span style=\"color: #BABED8\">state</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">      counter</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #F07178\"> </span><span style=\"color: #F78C6C\">100</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">  </span><span style=\"color: #F07178\">componentDidMount</span><span style=\"color: #89DDFF\">()</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #BABED8\">document</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">title</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">this.</span><span style=\"color: #BABED8\">state</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">counter</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">  </span><span style=\"color: #F07178\">componentDidUpdate</span><span style=\"color: #89DDFF\">()</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #BABED8\">console</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">log</span><span style=\"color: #F07178\">(</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">-------</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #F07178\">)</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #BABED8\">document</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">title</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">this.</span><span style=\"color: #BABED8\">state</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">counter</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">  </span><span style=\"color: #F07178\">componentWillUnmount</span><span style=\"color: #89DDFF\">()</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">  </span><span style=\"color: #F07178\">render</span><span style=\"color: #89DDFF\">()</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #C792EA\">const</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&#123;</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">counter</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">this.</span><span style=\"color: #BABED8\">state</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #F07178\"> (</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">      </span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #F07178\">div</span><span style=\"color: #89DDFF\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #F07178\">h2</span><span style=\"color: #89DDFF\">&gt;</span><span style=\"color: #BABED8\">计数: </span><span style=\"color: #89DDFF\">&#123;</span><span style=\"color: #BABED8\">counter</span><span style=\"color: #89DDFF\">&#125;&lt;/</span><span style=\"color: #F07178\">h2</span><span style=\"color: #89DDFF\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #F07178\">button</span><span style=\"color: #89DDFF\"> </span><span style=\"color: #C792EA\">onClick</span><span style=\"color: #89DDFF\">=&#123;</span><span style=\"color: #BABED8; font-style: italic\">e</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">this.</span><span style=\"color: #82AAFF\">setState</span><span style=\"color: #BABED8\">(</span><span style=\"color: #89DDFF\">&#123;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F07178\">counter</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\"> counter</span><span style=\"color: #89DDFF\">+</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #BABED8\">)</span><span style=\"color: #89DDFF\">&#125;&gt;</span><span style=\"color: #BABED8\">+1</span><span style=\"color: #89DDFF\">&lt;/</span><span style=\"color: #F07178\">button</span><span style=\"color: #89DDFF\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">      </span><span style=\"color: #89DDFF\">&lt;/</span><span style=\"color: #F07178\">div</span><span style=\"color: #89DDFF\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    )</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">export</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF; font-style: italic\">default</span><span style=\"color: #BABED8\"> App</span></span></code></pre></div><div class=\"language-jsx\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">jsx</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1d1d1d\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #676E95; font-style: italic\">// 函数式组件写法</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">import</span><span style=\"color: #BABED8\"> React</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">memo</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF; font-style: italic\">from</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">react</span><span style=\"color: #89DDFF\">&#39;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">import</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">useState</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">useEffect</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF; font-style: italic\">from</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">react</span><span style=\"color: #89DDFF\">&#39;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #C792EA\">const</span><span style=\"color: #BABED8\"> App </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">memo</span><span style=\"color: #BABED8\">(</span><span style=\"color: #89DDFF\">()</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #C792EA\">const</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">count</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">setCount</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #82AAFF\">useState</span><span style=\"color: #F07178\">(</span><span style=\"color: #F78C6C\">200</span><span style=\"color: #F07178\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #82AAFF\">useEffect</span><span style=\"color: #F07178\">(</span><span style=\"color: #89DDFF\">()</span><span style=\"color: #F07178\"> </span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">    </span><span style=\"color: #676E95; font-style: italic\">// 当前传入的回调函数会在组件被渲染完成后, 自动执行</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">    </span><span style=\"color: #676E95; font-style: italic\">// 网络请求/DOM操作(修改标题)/事件监听</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #BABED8\">document</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">title</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">count</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #F07178\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #F07178\"> (</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #F07178\">div</span><span style=\"color: #89DDFF\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">      </span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #F07178\">h2</span><span style=\"color: #89DDFF\">&gt;</span><span style=\"color: #BABED8\">当前计数: </span><span style=\"color: #89DDFF\">&#123;</span><span style=\"color: #BABED8\">count</span><span style=\"color: #89DDFF\">&#125;&lt;/</span><span style=\"color: #F07178\">h2</span><span style=\"color: #89DDFF\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">      </span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #F07178\">button</span><span style=\"color: #89DDFF\"> </span><span style=\"color: #C792EA\">onClick</span><span style=\"color: #89DDFF\">=&#123;</span><span style=\"color: #BABED8; font-style: italic\">e</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">setCount</span><span style=\"color: #BABED8\">(count</span><span style=\"color: #89DDFF\">+</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #BABED8\">)</span><span style=\"color: #89DDFF\">&#125;&gt;</span><span style=\"color: #BABED8\">+1</span><span style=\"color: #89DDFF\">&lt;/</span><span style=\"color: #F07178\">button</span><span style=\"color: #89DDFF\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF\">&lt;/</span><span style=\"color: #F07178\">div</span><span style=\"color: #89DDFF\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  )</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #BABED8\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">export</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF; font-style: italic\">default</span><span style=\"color: #BABED8\"> App</span></span></code></pre></div><ul>\n<li>清理副作用：如果当前组件中使用了<strong>定时器</strong>或绑定了<strong>事件监听程序</strong>，可以在返回的函数中清除定时器或解绑监听程序。</li>\n</ul>\n<div class=\"language-jsx\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">jsx</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1d1d1d\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #676E95; font-style: italic\">// 组件卸载或依赖项发生变化时执行，react会判断是否存在return函数，如果存在先执行return再执行useEffect函数</span></span>\n<span class=\"line\"><span style=\"color: #82AAFF\">useEffect</span><span style=\"color: #BABED8\">(</span><span style=\"color: #89DDFF\">()</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">  </span><span style=\"color: #676E95; font-style: italic\">// 1. 执行副作用操作</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">  </span><span style=\"color: #676E95; font-style: italic\">// 2. 返回一个清理副作用的函数</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">()</span><span style=\"color: #F07178\"> </span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&#123;</span><span style=\"color: #F07178\"> </span><span style=\"color: #676E95; font-style: italic\">/* 在这里执行自己的清理操作 */</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&#125;,</span><span style=\"color: #BABED8\"> [依赖项])</span></span></code></pre></div><ul>\n<li><strong>注意事项：</strong><ol>\n<li>不要在 useEffect 中改变依赖项的值，会造成<strong>死循环。</strong></li>\n<li>依赖项的值不应该是对象，会判断对象的引用；可以使用对象的具体属性或者使用<strong>展开运算符</strong>或**Object.assign()**生成一个新对象</li>\n<li>多个不同功能的副作用<strong>尽量分开声明</strong>，不要写到一个 useEffect 中。</li>\n</ol>\n</li>\n</ul>\n<hr>\n<h2 id=\"useLayoutEffect\"><a href=\"#useLayoutEffect\" class=\"headerlink\" title=\"useLayoutEffect\"></a>useLayoutEffect</h2><ul>\n<li>useEffect会在渲染的内容更新到DOM上<strong>后</strong>执行，异步执行，<strong>不会阻</strong>塞DOM的更新</li>\n<li>useLayoutEffect会在渲染的内容更新到DOM上之<strong>前</strong>执行，同步执行，<strong>会阻塞</strong>DOM的更新</li>\n<li><strong>如果我们希望在某些操作发生之后再更新DOM，那么应该将这个操作放到useLayoutEffect</strong></li>\n<li>注意：React 保证了 <code>useLayoutEffect</code> 中的代码以及其中任何计划的状态更新都会在浏览器重新绘制屏幕之前得到处理。</li>\n</ul>\n<hr>\n<h2 id=\"useInsertionEffect\"><a href=\"#useInsertionEffect\" class=\"headerlink\" title=\"useInsertionEffect\"></a>useInsertionEffect</h2><ul>\n<li>本质上 useInsertionEffect 主要是<strong>解决 CSS-in-JS 在渲染中注入样式的性能问题</strong>。除非你正在使用 CSS-in-JS 库并且需要注入样式，否则你应该使用 useEffect或者 useLayoutEffect</li>\n</ul>\n<div class=\"language-jsx\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">jsx</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1d1d1d\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">export</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF; font-style: italic\">default</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C792EA\">function</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">Index</span><span style=\"color: #89DDFF\">()&#123;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">React</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">useInsertionEffect</span><span style=\"color: #F07178\">(</span><span style=\"color: #89DDFF\">()</span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">     </span><span style=\"color: #676E95; font-style: italic\">/* 动态创建 style 标签插入到 head 中 */</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">     </span><span style=\"color: #C792EA\">const</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">style</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">document</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">createElement</span><span style=\"color: #F07178\">(</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">style</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #F07178\">)</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">     </span><span style=\"color: #BABED8\">style</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">innerHTML</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">`</span></span>\n<span class=\"line\"><span style=\"color: #C3E88D\">       .css-in-js&#123;</span></span>\n<span class=\"line\"><span style=\"color: #C3E88D\">         color: red;</span></span>\n<span class=\"line\"><span style=\"color: #C3E88D\">         font-size: 20px;</span></span>\n<span class=\"line\"><span style=\"color: #C3E88D\">       &#125;</span></span>\n<span class=\"line\"><span style=\"color: #C3E88D\">     </span><span style=\"color: #89DDFF\">`</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">     </span><span style=\"color: #BABED8\">document</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">head</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">appendChild</span><span style=\"color: #F07178\">(</span><span style=\"color: #BABED8\">style</span><span style=\"color: #F07178\">)</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #89DDFF\">&#125;,</span><span style=\"color: #F07178\">[])</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #F07178\">div</span><span style=\"color: #89DDFF\"> </span><span style=\"color: #C792EA\">className</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">css-in-js</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\"> &gt;</span><span style=\"color: #BABED8\"> hello , useInsertionEffect </span><span style=\"color: #89DDFF\">&lt;/</span><span style=\"color: #F07178\">div</span><span style=\"color: #89DDFF\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&#125;</span></span></code></pre></div><hr>\n<h2 id=\"useReducer\"><a href=\"#useReducer\" class=\"headerlink\" title=\"useReducer\"></a>useReducer</h2><ul>\n<li>useReducer仅仅是useState的一种替代方案:<ul>\n<li>在某些场景下，如果state的处理逻辑<strong>比较复杂</strong>，我们可以通过useReducer来对其<strong>进行拆分</strong></li>\n<li>或者这次修改的state需要依赖之前的state时，也可以使用；useReducer只是useState的一种替代品，并不能替代Redux</li>\n<li><strong>更好的描述“状态”，让代码逻辑更清晰，代码行为更易预测</strong></li>\n</ul>\n</li>\n<li>基础语法:</li>\n</ul>\n<div class=\"language-jsx\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">jsx</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1d1d1d\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #676E95; font-style: italic\">/*</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\">1. reducer 是一个函数，类似于 (prevState, action) =&gt; newState。形参 prevState 表示旧状态，形参 action 表示本次的行为，返回值 newState 表示处理完毕后的新状态。</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\">2. initState 表示初始状态，也就是默认值。</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\">3. initAction 是进行状态初始化时候的处理函数，它是可选的，如果提供了 initAction 函数，则会把 initState 传递给 initAction 函数进行处理，initAction 的返回值会被当做初始状态。</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\">4. 返回值 state 是状态值。dispatch 是更新 state 的方法，让他接收 action 作为参数，useReducer 只需要调用 dispatch(action) 方法传入的 action 即可更新 state。</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\">*/</span></span>\n<span class=\"line\"><span style=\"color: #C792EA\">const</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">state</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> dispatch</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">useReducer</span><span style=\"color: #BABED8\">(reducer</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> initState</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> initAction</span><span style=\"color: #89DDFF\">?</span><span style=\"color: #BABED8\">)</span></span></code></pre></div><p><strong>使用 Immer 编写更简洁的 reducer 更新逻辑</strong></p>\n<ol>\n<li>安装immer相关的依赖包：</li>\n</ol>\n<div class=\"language-js\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">js</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1d1d1d\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #BABED8\">npm install immer use</span><span style=\"color: #89DDFF\">-</span><span style=\"color: #BABED8\">immer </span><span style=\"color: #89DDFF\">-</span><span style=\"color: #BABED8\">S</span></span></code></pre></div><ol start=\"2\">\n<li>从 <code>use-immer</code> 中导入 <code>useImmerReducer</code> 函数，并替换掉 React 官方的 <code>useReducer</code> 函数的调用：</li>\n</ol>\n<div class=\"language-jsx\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">jsx</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1d1d1d\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #676E95; font-style: italic\">// 1. 导入 useImmerReducer</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">import</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">useImmerReducer</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF; font-style: italic\">from</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">use-immer</span><span style=\"color: #89DDFF\">&#39;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\">// 父组件</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">export</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C792EA\">const</span><span style=\"color: #BABED8\"> Father</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">React</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #FFCB6B\">FC</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">()</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\"> </span><span style=\"color: #676E95; font-style: italic\">// 2. 把 useReducer() 的调用替换成 useImmerReducer()</span></span>\n<span class=\"line\"><span style=\"color: #F07178\"> </span><span style=\"color: #C792EA\">const</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">state</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">dispatch</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #82AAFF\">useImmerReducer</span><span style=\"color: #F07178\">(</span><span style=\"color: #BABED8\">reducer</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">defaultState</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">initAction</span><span style=\"color: #F07178\">)</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&#125;</span></span></code></pre></div><ol start=\"3\">\n<li>修改 reducer 函数中的业务逻辑，<code>case</code> 代码块中不再需要 return 不可变的新对象了，只需要在 prevState 上进行修改即可。<strong>Immer 内部会复制并返回新对象</strong>，因此降低了用户的心智负担。</li>\n</ol>\n<hr>\n<h2 id=\"useSyncExternalStore\"><a href=\"#useSyncExternalStore\" class=\"headerlink\" title=\"useSyncExternalStore\"></a>useSyncExternalStore</h2><ul>\n<li><code>useSyncExternalStore</code> 是一个订阅外部 store 的 React Hook。 能够让 React 组件在 concurrent(同时调度) 模式下安全地有效地读取外接数据源，在组件渲染过程中能够检测到变化，并且在数据源发生变化的时候，能够调度更新。当读取到外部状态发生了变化，会触发一个强制更新，来保证结果的一致性。</li>\n</ul>\n<div class=\"language-js\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">js</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1d1d1d\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #C792EA\">const</span><span style=\"color: #BABED8\"> snapshot </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">useSyncExternalStore</span><span style=\"color: #BABED8\">(subscribe</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> getSnapshot</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> getServerSnapshot</span><span style=\"color: #89DDFF\">?</span><span style=\"color: #BABED8\">)</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\">/*</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\">参数一：subscribe：订阅函数，接收一个单独的 callback 参数并把它订阅到 store 上。当 store 发生改变，它应当调用被提供的 callback。这会导致组件重新渲染。subscribe 函数会返回清除订阅的函数。</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\">参数二：getSnapshot：一个函数，返回组件需要的 store 中的数据快照。在 store 不变的情况下，重复调用 getSnapshot 必须返回同一个值。如果 store 改变，并且返回值也不同了（用 Object.is 比较），React 就会重新渲染组件。</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\">参数三：可选 getServerSnapshot：hydration模式下的getSnapshot</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\">*/</span></span></code></pre></div><hr>\n<h2 id=\"useContext\"><a href=\"#useContext\" class=\"headerlink\" title=\"useContext\"></a>useContext</h2><ul>\n<li>Context Hook允许我们通过Hook来直接获取某个Context的值;<strong>当组件上层最近的&lt;MyContext.Provider&gt;更新时，该Hook会触发重新渲染，并使用最新传递给MyContext provider的context value值。</strong></li>\n<li>使用 props 层层传递数据的维护性太差了，我们可以使用 <code>React.createContext()</code> + <code>useContext()</code> 轻松实现多层组件的数据传递。</li>\n</ul>\n<div class=\"language-jsx\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">jsx</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1d1d1d\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">import</span><span style=\"color: #BABED8\"> React</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">memo</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">useContext</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF; font-style: italic\">from</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">react</span><span style=\"color: #89DDFF\">&#39;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">import</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">UserContext</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">ThemeContext</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF; font-style: italic\">from</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">./context</span><span style=\"color: #89DDFF\">&quot;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #C792EA\">const</span><span style=\"color: #BABED8\"> App </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">memo</span><span style=\"color: #BABED8\">(</span><span style=\"color: #89DDFF\">()</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">  </span><span style=\"color: #676E95; font-style: italic\">// 使用Context</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #C792EA\">const</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">user</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #82AAFF\">useContext</span><span style=\"color: #F07178\">(</span><span style=\"color: #BABED8\">UserContext</span><span style=\"color: #F07178\">)</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #C792EA\">const</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">theme</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #82AAFF\">useContext</span><span style=\"color: #F07178\">(</span><span style=\"color: #BABED8\">ThemeContext</span><span style=\"color: #F07178\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #F07178\"> (</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #F07178\">div</span><span style=\"color: #89DDFF\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">      </span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #F07178\">h2</span><span style=\"color: #89DDFF\">&gt;</span><span style=\"color: #BABED8\">User: </span><span style=\"color: #89DDFF\">&#123;</span><span style=\"color: #BABED8\">user</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">name</span><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #BABED8\">-</span><span style=\"color: #89DDFF\">&#123;</span><span style=\"color: #BABED8\">user</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">level</span><span style=\"color: #89DDFF\">&#125;&lt;/</span><span style=\"color: #F07178\">h2</span><span style=\"color: #89DDFF\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">      </span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #F07178\">h2</span><span style=\"color: #89DDFF\"> </span><span style=\"color: #C792EA\">style</span><span style=\"color: #89DDFF\">=&#123;&#123;color: theme.color, fontSize: theme.size&#125;&#125;&gt;Theme&lt;/h2&gt;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">    &lt;/div&gt;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">  )</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&#125;)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #C792EA\">export</span><span style=\"color: #89DDFF\"> </span><span style=\"color: #C792EA\">default</span><span style=\"color: #89DDFF\"> </span><span style=\"color: #C792EA\">App</span></span></code></pre></div><p><strong>非侵入的方式使用Context</strong></p>\n<ul>\n<li>为了保证父组件中代码的单一性，也为了提高 Provider 的通用性，我们可以考虑把 <code>Context.Provider</code> 封装到独立的 <code>Wrapper</code> 函数式组件中</li>\n</ul>\n<div class=\"language-ts\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">ts</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1d1d1d\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #676E95; font-style: italic\">// 声明 TS 类型</span></span>\n<span class=\"line\"><span style=\"color: #C792EA\">type</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">ContextType</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F07178\">count</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">number</span><span style=\"color: #89DDFF\">;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F07178\">setCount</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">React</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #FFCB6B\">Dispatch</span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #FFCB6B\">React</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #FFCB6B\">SetStateAction</span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #FFCB6B\">number</span><span style=\"color: #89DDFF\">&gt;&gt;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\">// 创建 Context 对象</span></span>\n<span class=\"line\"><span style=\"color: #C792EA\">const</span><span style=\"color: #BABED8\"> AppContext </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> React</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">createContext</span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #FFCB6B\">ContextType</span><span style=\"color: #89DDFF\">&gt;</span><span style=\"color: #BABED8\">(</span><span style=\"color: #89DDFF\">&#123;&#125;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF; font-style: italic\">as</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">ContextType</span><span style=\"color: #BABED8\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\">// 定义独立的 Wrapper 组件，被 Wrapper 嵌套的子组件会被 Provider 注入数据</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">export</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C792EA\">const</span><span style=\"color: #BABED8\"> AppContextWrapper</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">React</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #FFCB6B\">FC</span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #FFCB6B\">React</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #FFCB6B\">PropsWithChildren</span><span style=\"color: #89DDFF\">&gt;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">props</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">  </span><span style=\"color: #676E95; font-style: italic\">// 1. 定义要共享的数据</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #C792EA\">const</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">count</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">setCount</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #82AAFF\">useState</span><span style=\"color: #F07178\">(</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #F07178\">)</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">  </span><span style=\"color: #676E95; font-style: italic\">// 2. 使用 AppContext.Provider 向下共享数据</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #F07178\"> &lt;</span><span style=\"color: #FFCB6B\">AppContext</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #FFCB6B\">Provider</span><span style=\"color: #F07178\"> </span><span style=\"color: #FFCB6B\">value</span><span style=\"color: #F07178\">=</span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #F07178\">!--</span><span style=\"color: #FFCB6B\">swig</span><span style=\"color: #F07178\">￼</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #F07178\">--</span><span style=\"color: #89DDFF\">&gt;</span><span style=\"color: #F07178\">&gt;</span><span style=\"color: #89DDFF\">&#123;</span><span style=\"color: #F07178\">props.</span><span style=\"color: #BABED8\">children</span><span style=\"color: #89DDFF\">&#125;&lt;/</span><span style=\"color: #BABED8\">AppContext</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">Provider</span><span style=\"color: #89DDFF\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&#125;</span></span></code></pre></div><ul>\n<li>定义好 <code>Wrapper</code> 组件后，我们可以在 <code>App.tsx</code> 中导入并使用 <code>Wrapper</code> 和 <code>LevelA</code> 组件，代码如下：</li>\n</ul>\n<div class=\"language-jsx\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">jsx</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1d1d1d\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">import</span><span style=\"color: #BABED8\"> React </span><span style=\"color: #89DDFF; font-style: italic\">from</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">react</span><span style=\"color: #89DDFF\">&#39;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">import</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">AppContextWrapper</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">LevelA</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF; font-style: italic\">from</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">@/components/use_context/base.tsx</span><span style=\"color: #89DDFF\">&#39;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #C792EA\">const</span><span style=\"color: #BABED8\"> App</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">React</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #FFCB6B\">FC</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">()</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #F07178\"> (</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #FFCB6B\">AppContextWrapper</span><span style=\"color: #89DDFF\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">      &lt;!-- AppContextWrapper 中嵌套使用了 LevelA 组件，形成了父子关系 --&gt;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">      &lt;!-- LevelA 组件会被当做 children 渲染到 Wrapper 预留的插槽中 --&gt;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">      </span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #FFCB6B\">LevelA</span><span style=\"color: #89DDFF\"> /&gt;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF\">&lt;/</span><span style=\"color: #FFCB6B\">AppContextWrapper</span><span style=\"color: #89DDFF\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  )</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">export</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF; font-style: italic\">default</span><span style=\"color: #BABED8\"> App</span></span></code></pre></div><hr>\n<h2 id=\"useMemo\"><a href=\"#useMemo\" class=\"headerlink\" title=\"useMemo\"></a>useMemo</h2><ul>\n<li>当父组件被重新渲染的时候，也会触发子组件的重新渲染，这样就多出了无意义的性能开销。如果子组件的状态没有发生变化，则子组件是不需要被重新渲染的。在 React Hooks 中，我们可以使用 <code>React.memo</code> 来解决上述的问题，从而达到提高性能的目的。</li>\n</ul>\n<div class=\"language-js\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">js</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1d1d1d\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #C792EA\">const</span><span style=\"color: #BABED8\"> 组件 </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> React</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">memo</span><span style=\"color: #BABED8\">(函数式组件)</span></span></code></pre></div><ul>\n<li>useMemo会返回一个函数的memoized (记忆的)值;在依赖不变的情况下，多次定义的时候，返回的值是相同的</li>\n<li>useCallback 和 useMemo都是react可用于性能优化的内置hooks。两者的区别在于：<strong>useCallback缓存的是一个函数，而useMemo缓存的是计算结果。</strong></li>\n</ul>\n<div class=\"language-js\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">js</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1d1d1d\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #676E95; font-style: italic\">// useCallback</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\">// 第一个参数是一个回调函数，useCallback会缓存这个函数，返回缓存的回调函数</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\">// 第二个参数是依赖项，只有当依赖项改变时，才会重新创建这个函数</span></span>\n<span class=\"line\"><span style=\"color: #C792EA\">const</span><span style=\"color: #BABED8\"> memorizedCallback </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">useCallback</span><span style=\"color: #BABED8\">(</span><span style=\"color: #89DDFF\">()</span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #82AAFF\">doSomething</span><span style=\"color: #F07178\">(</span><span style=\"color: #BABED8\">a</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\">b</span><span style=\"color: #F07178\">)</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&#125;,</span><span style=\"color: #BABED8\">[a</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\">b])</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\"> </span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\">// useMemo</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\">// 第一个参数是一个函数，useMemo会缓存函数运行返回的值，返回缓存的值</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\">// 第二个参数是依赖项，只有当依赖改变时，才会重新计算这个值</span></span>\n<span class=\"line\"><span style=\"color: #C792EA\">const</span><span style=\"color: #BABED8\"> memorizedValue </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">useMemo</span><span style=\"color: #BABED8\">(</span><span style=\"color: #89DDFF\">()</span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #82AAFF\">computeValue</span><span style=\"color: #BABED8\">(a</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\">b)</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\">[a</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\">b])</span></span></code></pre></div><hr>\n<h2 id=\"useCallback\"><a href=\"#useCallback\" class=\"headerlink\" title=\"useCallback\"></a>useCallback</h2><ul>\n<li>useCallback 会返<strong>回一个 memorized 回调函数</strong>供组件使用，从而防止组件每次 rerender 时反复创建相同的函数，能够节省内存开销，提高性能。</li>\n</ul>\n<div class=\"language-jsx\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">jsx</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1d1d1d\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #C792EA\">const</span><span style=\"color: #BABED8\"> countRef </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">useRef</span><span style=\"color: #BABED8\">()</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">countRef</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">current </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> count</span></span>\n<span class=\"line\"><span style=\"color: #C792EA\">const</span><span style=\"color: #BABED8\"> increment </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">useCallback</span><span style=\"color: #BABED8\">(</span><span style=\"color: #C792EA\">function</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">foo</span><span style=\"color: #89DDFF\">()</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #BABED8\">console</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">log</span><span style=\"color: #F07178\">(</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">increment</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #F07178\">)</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #82AAFF\">setCount</span><span style=\"color: #F07178\">(</span><span style=\"color: #BABED8\">countRef</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">current</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #F07178\"> </span><span style=\"color: #F78C6C\">1</span><span style=\"color: #F07178\">)</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&#125;,</span><span style=\"color: #BABED8\"> [])</span></span></code></pre></div><hr>\n<h2 id=\"useTransition\"><a href=\"#useTransition\" class=\"headerlink\" title=\"useTransition\"></a>useTransition</h2><ul>\n<li><strong>返回一个状态值表示过渡任务的等待状态，以及一个启动该过渡任务的函数。</strong></li>\n<li><code>useTransition</code> 可以将一个更新转为<strong>低优先级</strong>更新，使其可以<strong>被打断</strong>，<strong>不阻塞 UI</strong> 对用户操作的响应，能够提高用户的使用体验。它常用于优化<strong>视图切换</strong>时的用户体验。</li>\n</ul>\n<div class=\"language-js\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">js</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1d1d1d\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #C792EA\">const</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">isPending</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> startTransition</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">useTransition</span><span style=\"color: #BABED8\">()</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\">// 参数：调用 useTransition 时不需要传递任何参数</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\">/*</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\">返回值（数组）：</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\">- isPending 布尔值：是否存在待处理的 transition，如果值为 true，说明页面上存在待渲染的部分，可以给用户展示一个加载的提示</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\">- startTransition 函数：调用此函数，可以把状态的更新标记为低优先级的，不阻塞 UI 对用户操作的响应</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\">*/</span></span></code></pre></div><ul>\n<li><strong>注意事项：</strong><ol>\n<li>传递给 <code>startTransition</code> 的函数必须是<strong>同步</strong>的。React 会立即执行此函数，并将在其执行期间发生的所有状态更新标记为 transition。异步状态更新不会被标记为 transition。</li>\n<li><strong>标记为 transition 的状态更新将被其他状态更新打断</strong>。例如在 transition 中更新图表组件，并在图表组件仍在重新渲染时继续在输入框中输入，React 将首先处理输入框的更新，之后再重新启动对图表组件的渲染工作。</li>\n<li>transition 更新不能用于控制文本输入。</li>\n</ol>\n</li>\n</ul>\n<hr>\n<h2 id=\"useDeferredValue\"><a href=\"#useDeferredValue\" class=\"headerlink\" title=\"useDeferredValue\"></a>useDeferredValue</h2><ul>\n<li>** useDeferredValue 接受一个值，并返回该值的新副本，该副本将推迟到更紧急地更新之后。**useDeferredValue的作用是一样的效果可以让我们的更新延迟。</li>\n<li>useTransition 是把 startTransition 内部的更新任务变成了过渡任务transtion；而 useDeferredValue 是把原值通过过渡任务得到新的值，这个值作为延时状态。 也就是说<strong>一个是处理一段逻辑，另一个是生产一个新的状态。</strong></li>\n<li>有些场景不能使用 <code>useTransition</code> 进行性能优化，因为 <code>useTransition</code> 会把状态更新标记为<strong>低优先级</strong>，<strong>被标记为 transition 的状态更新将被其他状态更新打断</strong>。因此在高频率输入时，会导致<strong>中间的输入状态丢失</strong>的问题。</li>\n</ul>\n<div class=\"language-js\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">js</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1d1d1d\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #676E95; font-style: italic\">// 根据 kw 得到延迟的 kw</span></span>\n<span class=\"line\"><span style=\"color: #C792EA\">const</span><span style=\"color: #BABED8\"> deferredKw </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">useDeferredValue</span><span style=\"color: #BABED8\">(kw)</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\">// 子组件配合React.memo实现中间状态的缓存</span></span></code></pre></div><ul>\n<li><code>useDeferredValue</code> 的返回值为一个<strong>延迟版的状态</strong>：<ol>\n<li>在组件首次渲染期间，返回值将与传入的值相同</li>\n<li>在组件更新期间，React 将<strong>首先使用旧值</strong>重新渲染 UI 结构，这能够<strong>跳过</strong>某些复杂组件的 rerender，从而<strong>提高渲染效率</strong>。随后，React 将使用新值更新 deferredValue，并在后台使用新值重新渲染是一个<strong>低优先级的更新</strong>。这也意味着，如果在后台使用新值更新时 value 再次改变，它将打断那次更新。</li>\n</ol>\n</li>\n</ul>\n<hr>\n<h2 id=\"useDebugValue\"><a href=\"#useDebugValue\" class=\"headerlink\" title=\"useDebugValue\"></a>useDebugValue</h2><ul>\n<li>useDebugValue 可用于在 React 开发者工具中<strong>显示自定义 hook 的标签</strong>。这个hooks目的就是检查自定义hooks。在生产环境中，<code>useDebugValue</code> 不会产生任何效果，因为它只用于调试目的。</li>\n</ul>\n<div class=\"language-jsx\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">jsx</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1d1d1d\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">import</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">useDebugValue</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF; font-style: italic\">from</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">react</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #C792EA\">function</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">useOnlineStatus</span><span style=\"color: #89DDFF\">()</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">  </span><span style=\"color: #676E95; font-style: italic\">// ...</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #82AAFF\">useDebugValue</span><span style=\"color: #F07178\">(</span><span style=\"color: #BABED8\">isOnline</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">?</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">Online</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">:</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">Offline</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #F07178\">)</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">  </span><span style=\"color: #676E95; font-style: italic\">// ...</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\">// useDebugValue(value, format?)</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\">// 参数一：value--值，可以是任何类型</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\">// 参数二：可选的format--格式化函数，不指定的直接显示value</span></span></code></pre></div><hr>\n<h2 id=\"useId\"><a href=\"#useId\" class=\"headerlink\" title=\"useId\"></a>useId</h2><ul>\n<li><strong>useld是一个用于生成横跨服务端和客户端的稳定的唯一ID的同时避免 hydration 不匹配的hook。</strong></li>\n</ul>\n<div class=\"language-jsx\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">jsx</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1d1d1d\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">import</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">useId</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF; font-style: italic\">from</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">react</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #C792EA\">function</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">PasswordField</span><span style=\"color: #89DDFF\">()</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #C792EA\">const</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">passwordHintId</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #82AAFF\">useId</span><span style=\"color: #F07178\">()</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">  </span><span style=\"color: #676E95; font-style: italic\">// ...</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&#125;</span></span></code></pre></div><ul>\n<li><p>useld是用于react的同构应用开发的，前端的SPA页面并不需要使用它</p>\n<ul>\n<li>useld可以保证应用程序在客户端和服务器端生成唯一的ID，这样可以有效的避免通过一些手段生成的id不一致，造成hydration mismatch</li>\n</ul>\n</li>\n<li><p>在进行SSR时，我们的页面会呈现为HTML。但仅HTML不足以使页面具有交互性。例如，浏览器端JavaScript为零的页面不能是交互式的(没有JavaScript事件处理程序来响应用户操作，例如单击按钮)。<strong>为了使我们的页面具有交互性，除了在Node.js中将页面呈现为HTML之外，我们的UI框架（Vue&#x2F;React…）还在浏览器中加载和呈现页面。(它创建页面的内部表示，然后将内部表示映射到我们在Node.js中呈现的HTML的DOM元素。)</strong><br><strong>这个过程称为hydration。</strong></p>\n</li>\n</ul>\n<hr>\n<h2 id=\"自定义Hook\"><a href=\"#自定义Hook\" class=\"headerlink\" title=\"自定义Hook\"></a>自定义Hook</h2><ul>\n<li>自定义Hook本质上只是一种函数代码逻辑的抽取，严格意义上来说，它本身并不算React的特性。</li>\n<li>举例:：</li>\n</ul>\n<div class=\"language-js\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">js</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1d1d1d\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #676E95; font-style: italic\">// 使用本地存储</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">import</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">useEffect</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF; font-style: italic\">from</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">react</span><span style=\"color: #89DDFF\">&quot;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">import</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">useState</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF; font-style: italic\">from</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">react</span><span style=\"color: #89DDFF\">&quot;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #C792EA\">function</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">useLocalStorage</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">key</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">  </span><span style=\"color: #676E95; font-style: italic\">// 1.从localStorage中获取数据, 并且数据数据创建组件的state</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #C792EA\">const</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">data</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">setData</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #82AAFF\">useState</span><span style=\"color: #F07178\">(</span><span style=\"color: #89DDFF\">()</span><span style=\"color: #F07178\"> </span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #C792EA\">const</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">item</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">localStorage</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">getItem</span><span style=\"color: #F07178\">(</span><span style=\"color: #BABED8\">key</span><span style=\"color: #F07178\">)</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #F07178\"> (</span><span style=\"color: #89DDFF\">!</span><span style=\"color: #BABED8\">item</span><span style=\"color: #F07178\">) </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&quot;&quot;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">JSON</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">parse</span><span style=\"color: #F07178\">(</span><span style=\"color: #BABED8\">item</span><span style=\"color: #F07178\">)</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #F07178\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">  </span><span style=\"color: #676E95; font-style: italic\">// 2.监听data改变, 一旦发生改变就存储data最新值</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #82AAFF\">useEffect</span><span style=\"color: #F07178\">(</span><span style=\"color: #89DDFF\">()</span><span style=\"color: #F07178\"> </span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #BABED8\">localStorage</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">setItem</span><span style=\"color: #F07178\">(</span><span style=\"color: #BABED8\">key</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">JSON</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">stringify</span><span style=\"color: #F07178\">(</span><span style=\"color: #BABED8\">data</span><span style=\"color: #F07178\">))</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #89DDFF\">&#125;,</span><span style=\"color: #F07178\"> [</span><span style=\"color: #BABED8\">data</span><span style=\"color: #F07178\">])</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">  </span><span style=\"color: #676E95; font-style: italic\">// 3.将data/setData的操作返回给组件, 让组件可以使用和修改值</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #F07178\"> [</span><span style=\"color: #BABED8\">data</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">setData</span><span style=\"color: #F07178\">]</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">export</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF; font-style: italic\">default</span><span style=\"color: #BABED8\"> useLocalStorage</span></span></code></pre></div><div class=\"language-js\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">js</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1d1d1d\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #676E95; font-style: italic\">// 获取当前鼠标位置</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">import</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">useEffect</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">useState</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF; font-style: italic\">from</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">react</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">export</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C792EA\">const</span><span style=\"color: #BABED8\"> useMousePosition </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">delay</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">number</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #C792EA\">const</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">position</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">setPosition</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #82AAFF\">useState</span><span style=\"color: #F07178\">(</span><span style=\"color: #89DDFF\">&#123;</span><span style=\"color: #F07178\"> x</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #F07178\"> </span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> y</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #F07178\"> </span><span style=\"color: #F78C6C\">0</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #F07178\">)</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #82AAFF\">useEffect</span><span style=\"color: #F07178\">(</span><span style=\"color: #89DDFF\">()</span><span style=\"color: #F07178\"> </span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #C792EA\">let</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">timer</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #F07178\"> </span><span style=\"color: #FFCB6B\">null</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">|</span><span style=\"color: #F07178\"> </span><span style=\"color: #FFCB6B\">NodeJS</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #FFCB6B\">Timeout</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">null;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #C792EA\">const</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">mouseMoveHandler</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">e</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #F07178\"> </span><span style=\"color: #FFCB6B\">MouseEvent</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #F07178\"> </span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">      </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #F07178\"> (</span><span style=\"color: #BABED8\">timer</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">!==</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">null</span><span style=\"color: #F07178\">) </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">      </span><span style=\"color: #BABED8\">timer</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #82AAFF\">setTimeout</span><span style=\"color: #F07178\">(</span><span style=\"color: #89DDFF\">()</span><span style=\"color: #F07178\"> </span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">        </span><span style=\"color: #82AAFF\">setPosition</span><span style=\"color: #F07178\">(</span><span style=\"color: #89DDFF\">&#123;</span><span style=\"color: #F07178\"> x</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">e</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">clientX</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> y</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">e</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">clientY</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #F07178\">)</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">        </span><span style=\"color: #BABED8\">timer</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">null;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">      </span><span style=\"color: #89DDFF\">&#125;,</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">delay</span><span style=\"color: #F07178\">)</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #89DDFF\">&#125;;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #BABED8\">window</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">addEventListener</span><span style=\"color: #F07178\">(</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">mousemove</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">mouseMoveHandler</span><span style=\"color: #F07178\">)</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">()</span><span style=\"color: #F07178\"> </span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">window</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">removeEventListener</span><span style=\"color: #F07178\">(</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">mousemove</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">mouseMoveHandler</span><span style=\"color: #F07178\">)</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #89DDFF\">&#125;,</span><span style=\"color: #F07178\"> [])</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">position</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&#125;;</span></span></code></pre></div>","feature":false,"text":"React是由Facebook开发的一款JavaScript库，用于构建用户界面。它采用组件化的方式进行开发，支持虚拟DOM技术，能够有效提高页面渲染性能。React具有易于学习、灵活、高效等特点，被广泛应用于Web应用和移动应用的开发中。本文对React的hooks进行了概括说明。...","permalink":"/post/React快速入门（四）ReactHooks","photos":[],"count_time":{"symbolsCount":"17k","symbolsTime":"15 mins."},"categories":[{"name":"前端","slug":"前端","count":52,"path":"api/categories/前端.json"}],"tags":[{"name":"react","slug":"react","count":4,"path":"api/tags/react.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#React%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%EF%BC%88%E5%9B%9B%EF%BC%89ReactHooks\"><span class=\"toc-text\">React快速入门（四）ReactHooks</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#useState\"><span class=\"toc-text\">useState</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#useRef\"><span class=\"toc-text\">useRef</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#useEffect\"><span class=\"toc-text\">useEffect</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#useLayoutEffect\"><span class=\"toc-text\">useLayoutEffect</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#useInsertionEffect\"><span class=\"toc-text\">useInsertionEffect</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#useReducer\"><span class=\"toc-text\">useReducer</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#useSyncExternalStore\"><span class=\"toc-text\">useSyncExternalStore</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#useContext\"><span class=\"toc-text\">useContext</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#useMemo\"><span class=\"toc-text\">useMemo</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#useCallback\"><span class=\"toc-text\">useCallback</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#useTransition\"><span class=\"toc-text\">useTransition</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#useDeferredValue\"><span class=\"toc-text\">useDeferredValue</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#useDebugValue\"><span class=\"toc-text\">useDebugValue</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#useId\"><span class=\"toc-text\">useId</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E8%87%AA%E5%AE%9A%E4%B9%89Hook\"><span class=\"toc-text\">自定义Hook</span></a></li></ol></li></ol>","author":{"name":"会思想的苇草i","slug":"blog-author","avatar":"/img/avatar.jpg","link":"/","description":"日拱一卒，功不唐捐 <br/> With each day's arduous effort,<br/>no achievement shall be in vain","socials":{"github":"https://github.com/Thinkingreedi","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/ASHIYI66","juejin":"https://juejin.cn/user/4284166567110935","customs":{}}},"mapped":true,"hidden":false,"prev_post":{"title":"简洁高效的样式编写：揭秘Tailwind CSS","uid":"85079fc8b482b07bf1c46c305ca3f3b0","slug":"前端--Tailwind CSS浅析与实操","date":"2023-10-08T02:41:03.000Z","updated":"2025-07-14T15:12:20.464Z","comments":true,"path":"api/articles/前端--Tailwind CSS浅析与实操.json","keywords":"web前端开发,web前端博客,个人博客,html,css,javascript,vue,react","cover":"https://img-blog.csdnimg.cn/direct/5e815334e934418fba98adf3a9f46e43.jpeg","text":"Tailwind CSS是一种实用的CSS框架，通过提供一组原子类，使得构建用户界面更加高效。它不同于传统的CSS框架，可以让你直接在HTML中使用类来定义样式，而无需编写自定义的CSS。Tailwind CSS提倡快速开发和一致的UI设计，同时也支持自定义主题和扩展性。这使得它成为许多开发者喜爱的工具，特别是对于快速原型设计和快速迭代的项目。...","permalink":"/post/前端--Tailwind CSS浅析与实操","photos":[],"count_time":{"symbolsCount":"8.4k","symbolsTime":"8 mins."},"categories":[{"name":"前端","slug":"前端","count":52,"path":"api/categories/前端.json"}],"tags":[{"name":"CSS","slug":"CSS","count":4,"path":"api/tags/CSS.json"}],"author":{"name":"会思想的苇草i","slug":"blog-author","avatar":"/img/avatar.jpg","link":"/","description":"日拱一卒，功不唐捐 <br/> With each day's arduous effort,<br/>no achievement shall be in vain","socials":{"github":"https://github.com/Thinkingreedi","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/ASHIYI66","juejin":"https://juejin.cn/user/4284166567110935","customs":{}}},"feature":true},"next_post":{"title":"React快速入门（三）动画、状态与路由","uid":"53bbf2ae7f1993bfc42bfd635b4923f6","slug":"React快速入门（三）动画、状态与路由","date":"2025-12-02T15:02:00.000Z","updated":"2025-12-02T15:07:18.424Z","comments":true,"path":"api/articles/React快速入门（三）动画、状态与路由.json","keywords":"web前端开发,web前端博客,个人博客,html,css,javascript,vue,react","cover":"https://i-blog.csdnimg.cn/blog_migrate/cover/7ae60f2846f83a4bd4333f2e9b649239.jpeg","text":"React是由Facebook开发的一款JavaScript库，用于构建用户界面。它采用组件化的方式进行开发，支持虚拟DOM技术，能够有效提高页面渲染性能。React具有易于学习、灵活、高效等特点，被广泛应用于Web应用和移动应用的开发中。本文对React的动画、状态与路由进行了简要概括。...","permalink":"/post/React快速入门（三）动画、状态与路由","photos":[],"count_time":{"symbolsCount":"17k","symbolsTime":"15 mins."},"categories":[{"name":"前端","slug":"前端","count":52,"path":"api/categories/前端.json"}],"tags":[{"name":"react","slug":"react","count":4,"path":"api/tags/react.json"}],"author":{"name":"会思想的苇草i","slug":"blog-author","avatar":"/img/avatar.jpg","link":"/","description":"日拱一卒，功不唐捐 <br/> With each day's arduous effort,<br/>no achievement shall be in vain","socials":{"github":"https://github.com/Thinkingreedi","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/ASHIYI66","juejin":"https://juejin.cn/user/4284166567110935","customs":{}}},"feature":false}}